import { useEffect } from 'react';
import Head from 'next/head';
import { useRouter } from 'next/router';

const APP_STORE_URL = 'https://apps.apple.com/app/id6745149931';

export default function NoteFallback() {
  const { query } = useRouter();
  const { id } = query;
  const deepLink = `notely://note/${id}`;

  useEffect(() => {
    // Try to open the app; if not installed, fall back after 2s
    const timer = setTimeout(() => {
      window.location.replace(APP_STORE_URL);
    }, 2000);
    // Attempt to open immediately
    window.location.replace(deepLink);
    return () => clearTimeout(timer);
  }, [id]);

  return (
    <>
      <Head>
        <title>Open in Notely</title>
        <meta name="description" content="Import this summary into Notely." />
        {/* Smart App Banner */}
        <meta
          name="apple-itunes-app"
          content={`app-id=6745149931, app-argument=${deepLink}`}
        />
      </Head>
      <main style={{
        maxWidth: '480px',
        margin: '15vh auto',
        textAlign: 'center',
        fontFamily: 'system-ui, sans-serif',
      }}>
        <h1>Open in Notely</h1>
        <p>
          If you have the Notely app installed, it should open now.<br />
          Otherwise, you will be redirected to the App Store shortly.
        </p>
        <a
          href={deepLink}
          style={{
            display: 'inline-block',
            marginTop: '24px',
            padding: '14px 28px',
            background: '#0070f3',
            color: '#fff',
            borderRadius: '14px',
            textDecoration: 'none',
            fontWeight: 600,
          }}
        >
          Open in Notely
        </a>
      </main>
    </>
  );
}
